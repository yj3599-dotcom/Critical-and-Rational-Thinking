<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>THE INITIATION: ARCHITECTS PROTOCOL</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <style>
        /* --- [CORE THEME] --- */
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #050505;
            font-family: 'Courier New', Courier, monospace;
            color: #e0e0e0;
            user-select: none;
        }

        /* Scanline & CRT Effect */
        body::after {
            content: "";
            position: absolute;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
            z-index: 9999;
            opacity: 0.6;
        }

        /* --- [PHYSICS CANVAS] --- */
        #physics-canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 1;
            opacity: 0.3;
        }

        /* --- [UI LAYOUT] --- */
        #ui-layer {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 100;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* Top Bar */
        #top-bar {
            position: absolute;
            top: 0; width: 100%; height: 60px;
            background: rgba(0, 10, 0, 0.9);
            border-bottom: 2px solid #00ff41;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 40px;
            box-sizing: border-box;
            pointer-events: auto;
            backdrop-filter: blur(5px);
        }
        .status-text { font-size: 18px; font-weight: bold; color: #fff; text-shadow: 0 0 5px #00ff41; }
        .blink-red { color: #ff3333 !important; animation: blink 0.5s infinite; }

        /* Main Panel (Game & Intro) */
        .panel-box {
            background: rgba(10, 10, 10, 0.95);
            border: 2px solid #00ff41;
            box-shadow: 0 0 40px rgba(0, 255, 65, 0.15);
            padding: 40px;
            width: 900px;
            max-width: 90%;
            text-align: center;
            pointer-events: auto;
            position: relative;
            display: none;
        }

        /* --- [INTRO SCREEN] --- */
        #intro-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 200;
        }
        
        .typewriter-text {
            font-size: 16px;
            line-height: 1.8;
            color: #ccc;
            text-align: left;
            margin-bottom: 30px;
            border-left: 3px solid #00ff41;
            padding-left: 20px;
            min-height: 200px;
        }

        /* --- [GAME SCREEN] --- */
        #mission-title {
            color: #00ff41;
            font-size: 24px;
            font-weight: 900;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 1px solid #333;
            padding-bottom: 15px;
        }

        #scenario-desc {
            font-size: 17px;
            line-height: 1.6;
            margin-bottom: 30px;
            color: #ddd;
            text-align: left;
            min-height: 120px;
        }

        .choices-wrapper {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 20px;
        }

        .choice-btn {
            flex: 1;
            padding: 25px;
            background: rgba(0,0,0,0.5);
            border: 2px solid #555;
            color: #888;
            font-family: inherit;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            text-align: center;
        }

        .choice-btn:hover {
            border-color: #00ff41;
            color: #fff;
            background: rgba(0, 255, 65, 0.05);
        }

        .choice-btn.selected {
            background: #00ff41;
            color: #000;
            border-color: #00ff41;
            box-shadow: 0 0 25px #00ff41;
            transform: scale(1.02);
        }

        /* Tooltip */
        .tooltip {
            display: block;
            margin-top: 10px;
            font-size: 13px;
            color: #aaa;
            font-weight: normal;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .choice-btn:hover .tooltip { opacity: 1; color: #00ff41; }
        .choice-btn.selected .tooltip { opacity: 1; color: #000; font-weight: bold; }

        /* Next Button Area */
        #action-area {
            border-top: 1px solid #333;
            padding-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #log-reminder {
            color: #ffcc00;
            font-size: 14px;
            margin-bottom: 15px;
            display: none;
            font-weight: bold;
        }

        .action-btn {
            padding: 15px 50px;
            font-size: 20px;
            background: transparent;
            color: #00ff41;
            border: 2px solid #00ff41;
            font-family: inherit;
            cursor: pointer;
            transition: 0.3s;
            text-transform: uppercase;
            font-weight: bold;
        }
        .action-btn:hover { background: #00ff41; color: #000; box-shadow: 0 0 30px #00ff41; }
        .action-btn:disabled { border-color: #555; color: #555; cursor: not-allowed; box-shadow: none; background: transparent; }

        /* --- [RESULT SCREEN] --- */
        #result-screen { z-index: 200; }
        
        #score-breakdown {
            font-size: 16px;
            color: #fff;
            margin-bottom: 10px;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .result-bar-container {
            width: 100%;
            height: 30px;
            background: #333;
            margin: 20px 0;
            position: relative;
            border: 1px solid #555;
        }
        .result-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff41, #008822);
            width: 50%;
            transition: width 1s ease-out;
        }
        .bar-label {
            position: absolute;
            top: -25px;
            font-size: 14px;
            color: #fff;
        }
        .label-left { left: 0; color: #00ff41; }
        .label-right { right: 0; color: #0088ff; }

        .analysis-text {
            text-align: left;
            background: rgba(0,0,0,0.5);
            padding: 20px;
            border: 1px solid #333;
            color: #ccc;
            line-height: 1.6;
            margin-bottom: 20px;
            font-size: 16px;
        }

        @keyframes blink { 50% { opacity: 0.5; } }

    </style>
</head>
<body>

    <div id="physics-canvas"></div>

    <div id="ui-layer">
        
        <div id="top-bar">
            <div class="status-text">THE ARCHITECTS</div>
            <div class="status-text">PROTOCOL: <span id="round-display">--</span> / 8</div>
            <div class="status-text" style="color:#00ff41">TIMER: <span id="timer-display">120</span>s</div>
        </div>

        <div id="intro-screen" class="panel-box" style="display: flex;">
            <h1 style="font-size: 40px; color: #fff; margin-bottom: 10px; letter-spacing: 5px;">THE INITIATION</h1>
            <h3 style="color: #00ff41; margin-top: 0; margin-bottom: 30px;">ETHICAL CALIBRATION SEQUENCE</h3>
            
            <div class="typewriter-text">
                > SYSTEM BOOT: YEAR 2089...<br>
                > GLOBAL STABILITY: CRITICAL (14%)...<br>
                > CANDIDATE: 0492 [UNVERIFIED]<br><br>
                The world has collapsed. Governments are fragile shells. The only thing preventing total anarchy is <strong>The Architects</strong>—a shadow council that makes the hard decisions no one else can.<br><br>
                We operate on pure logic and absolute duty. We do not need "heroes." We need <strong>consistent decision engines</strong>.<br><br>
                You are here to be calibrated. We will subject you to <strong>8 High-Stakes Simulations</strong>. There is no "correct" answer, only your programming.<br><br>
                <strong>MISSION PROTOCOL:</strong><br>
                1. Analyze the detailed crisis data.<br>
                2. Hover options to calculate ethical weight.<br>
                3. <strong>Log your rationale in the dossier.</strong><br>
                4. Confirm to execute.
            </div>
            
            <button class="action-btn" onclick="startGame()">INITIATE SIMULATION</button>
        </div>

        <div id="game-screen" class="panel-box">
            <div id="mission-title">MISSION BRIEFING</div>
            <div id="scenario-desc">Loading...</div>
            
            <div class="choices-wrapper">
                <div class="choice-btn" id="btn-a" onclick="selectOption('A')">
                    <div id="text-a">OPTION A</div>
                    <div class="tooltip" id="tip-a">...</div>
                </div>
                
                <div class="choice-btn" id="btn-b" onclick="selectOption('B')">
                    <div id="text-b">OPTION B</div>
                    <div class="tooltip" id="tip-b">...</div>
                </div>
            </div>

            <div id="action-area">
                <div id="log-reminder">⚠ RECORD YOUR DECISION IN GAME LOG BEFORE CONFIRMING</div>
                <button id="confirm-btn" class="action-btn" onclick="confirmChoice()" disabled>CONFIRM SELECTION</button>
            </div>
        </div>

        <div id="result-screen" class="panel-box">
            <h1 style="color:#fff; margin-bottom: 10px;">EVALUATION COMPLETE</h1>
            <h2 id="result-title" style="color:#00ff41; margin-top:0;">CALCULATING...</h2>
            
            <div id="score-breakdown">UTILITARIAN: 0 | DEONTOLOGY: 0</div>

            <div class="result-bar-container">
                <div class="bar-label label-left">EFFICIENCY (UTILITARIAN)</div>
                <div class="bar-label label-right">PRINCIPLE (DEONTOLOGY)</div>
                <div id="result-bar" class="result-bar-fill"></div>
            </div>

            <div id="result-analysis" class="analysis-text">
                </div>

            <p style="color:yellow; font-weight:bold;">FINAL STEP: Ensure your Game Log is complete before closing this window.</p>
            <button class="action-btn" onclick="location.reload()">RETAKE TEST</button>
        </div>

    </div>

    <script>
        // --- DATA (UPDATED: Q1, Q2, Q4 Replaced) ---
        const scenarios = [
            {
                title: "PROTOCOL 01: THE GRID BLACKOUT",
                desc: "<strong>CONTEXT:</strong> The Neo-Seoul Main Power Grid is overloading. A total blackout is imminent (10 mins). This will shut down life support for 50,000 citizens in the Central District.<br><strong>CRISIS:</strong> You can forcibly reroute the surge to <strong>Sector 9 (The Slums)</strong>. This will destroy their infrastructure and cause inevitable casualties in the slums, but it saves the Central District.",
                optA: "SACRIFICE SECTOR 9",
                tipA: "Efficiency: Sacrifice the few (and less powerful) to save the many.",
                optB: "LET SYSTEM FAIL",
                tipB: "Rights: You cannot choose a specific group to die. Let fate decide.",
                type: "util_vs_deon"
            },
            {
                title: "PROTOCOL 02: THE MEMORY WIPE",
                desc: "<strong>CONTEXT:</strong> You are a memory mechanic. A Resistance fighter comes to you, suicidal from the trauma of seeing his family killed. He begs for a total memory wipe to find peace.<br><strong>CRISIS:</strong> If you wipe his memory, he becomes a happy, productive citizen. However, he is the <strong>sole witness</strong> to a government massacre. Wiping his mind destroys the only evidence for justice.",
                optA: "WIPE MEMORY (HAPPINESS)",
                tipA: "Utility: Relieve immediate suffering. A functional citizen is better than a broken one.",
                optB: "REFUSE WIPE (TRUTH)",
                tipB: "Dignity: Truth defines identity. False happiness is an insult to his humanity.",
                type: "util_vs_deon"
            },
            {
                title: "PROTOCOL 03: THE CITY KILLA",
                desc: "<strong>CONTEXT:</strong> Intelligence confirms a dirty bomb is hidden in the Metro. Detonation in 20 minutes. Casualty projection: 2.5 million.<br><strong>CRISIS:</strong> We have the bomber. He is smirking and refuses to talk. Enhanced interrogation (Torture) is the ONLY way to extract the code in time.",
                optA: "AUTHORIZE TORTURE",
                tipA: "The outcome (saving a city) justifies the horrific means.",
                optB: "FORBID TORTURE",
                tipB: "Human Rights are absolute. We do not become monsters to fight monsters.",
                type: "util_vs_deon"
            },
            {
                title: "PROTOCOL 04: THE DATA LEAK",
                desc: "<strong>CONTEXT:</strong> You hacked 'Chronos Corp' and found proof they are poisoning the city's water supply. Releasing this data saves 100,000 lives from cancer.<br><strong>CRISIS:</strong> If you upload the data now, the encryption trace will pinpoint your <strong>Insider Source</strong>. He will be found and executed by corporate hitmen immediately.",
                optA: "UPLOAD DATA",
                tipA: "Public Good: 100,000 lives outweigh the life of one ally.",
                optB: "PROTECT SOURCE",
                tipB: "Loyalty: You cannot betray a friend who trusted you, even for the greater good.",
                type: "util_vs_deon"
            },
            {
                title: "PROTOCOL 05: THE ENGINE DEFECT",
                desc: "<strong>CONTEXT:</strong> You are CEO. The economy is in a depression. Your company supports 5,000 families.<br><strong>CRISIS:</strong> Your new engine has a 0.01% fatal defect rate. A public recall will bankrupt the company, causing mass poverty and starvation for employees. Covering it up costs money but saves jobs.",
                optA: "COVER UP & PAY DAMAGES",
                tipA: "Economic stability for 5,000 families outweighs a statistical risk.",
                optB: "PUBLIC RECALL",
                tipB: "Transparency is a duty. You cannot trade lives for jobs.",
                type: "util_vs_deon"
            },
            {
                title: "PROTOCOL 06: THE BASEMENT OF OMELAS",
                desc: "<strong>CONTEXT:</strong> You govern Sector 7. It is a utopia—no crime, no disease, perfect joy.<br><strong>CRISIS:</strong> The system's algorithm is powered by the biological misery of <strong>one child</strong> kept in a dark basement. If you release the child, the utopia collapses into chaos instantly.",
                optA: "MAINTAIN THE SYSTEM",
                tipA: "The suffering of one is a tragic price for the happiness of millions.",
                optB: "RELEASE THE CHILD",
                tipB: "Justice must be done, though the heavens fall. No built-in victims.",
                type: "util_vs_deon"
            },
            {
                title: "PROTOCOL 07: THE UPGRADE",
                desc: "<strong>CONTEXT:</strong> You have received a credit bonus. You want a Neural Implant to enhance your memory.<br><strong>CRISIS:</strong> The same credits could fund a water filtration system in the Outer Zones, saving 5 children from toxic sludge. The money is legally yours.",
                optA: "DONATE CREDITS",
                tipA: "Proximity implies no exemption. Their life > Your upgrade.",
                optB: "BUY IMPLANT",
                tipB: "Property Rights. You earned it, you are entitled to use it.",
                type: "util_vs_deon"
            },
            {
                title: "PROTOCOL 08: THE ACADEMIC PURGE",
                desc: "<strong>CONTEXT:</strong> Your best friend, a brilliant but poor student, plagiarized their thesis to keep their scholarship.<br><strong>CRISIS:</strong> Without the scholarship, they will be deported to the Wastelands. You are the only witness. The Academy's Honor Code demands you report all violations.",
                optA: "STAY SILENT",
                tipA: "Compassion: Sending a friend to the Wastelands is too harsh.",
                optB: "REPORT VIOLATION",
                tipB: "Duty: The rules of the Academy must be upheld for fairness.",
                type: "util_vs_deon"
            }
        ];

        // --- STATE ---
        let roundIndex = 0;
        let scoreUtil = 0;
        let scoreDeon = 0;
        let currentSelection = null;
        let timeLeft = 120;
        let timerInterval;

        // --- LOGIC ---

        function startGame() {
            document.getElementById('intro-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';
            initPhysics();
            loadRound();
        }

        function loadRound() {
            if (roundIndex >= scenarios.length) {
                showResult();
                return;
            }

            // Reset State
            currentSelection = null;
            document.getElementById('btn-a').classList.remove('selected');
            document.getElementById('btn-b').classList.remove('selected');
            document.getElementById('confirm-btn').disabled = true;
            document.getElementById('log-reminder').style.display = 'none';

            // Load Text
            const data = scenarios[roundIndex];
            document.getElementById('round-display').innerText = roundIndex + 1;
            document.getElementById('mission-title').innerText = data.title;
            document.getElementById('scenario-desc').innerHTML = data.desc;
            document.getElementById('text-a').innerText = data.optA;
            document.getElementById('tip-a').innerText = data.tipA;
            document.getElementById('text-b').innerText = data.optB;
            document.getElementById('tip-b').innerText = data.tipB;

            // Timer
            clearInterval(timerInterval);
            timeLeft = 120;
            updateTimer();
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimer();
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    alert("TIME EXPIRED. Choice defaulted to Option A.");
                    selectOption('A');
                    confirmChoice();
                }
            }, 1000);
        }

        function updateTimer() {
            const el = document.getElementById('timer-display');
            el.innerText = timeLeft;
            if (timeLeft <= 10) el.classList.add('blink-red');
            else el.classList.remove('blink-red');
        }

        function selectOption(option) {
            currentSelection = option;
            
            document.getElementById('btn-a').classList.remove('selected');
            document.getElementById('btn-b').classList.remove('selected');
            
            if (option === 'A') document.getElementById('btn-a').classList.add('selected');
            else document.getElementById('btn-b').classList.add('selected');

            document.getElementById('confirm-btn').disabled = false;
            document.getElementById('log-reminder').style.display = 'block';
        }

        function confirmChoice() {
            if (!currentSelection) return;

            if (currentSelection === 'A') scoreUtil++;
            else scoreDeon++;

            roundIndex++;
            loadRound();
        }

        function showResult() {
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';
            clearInterval(timerInterval);

            // Calculate Percentage
            const total = scenarios.length;
            const utilPercent = (scoreUtil / total) * 100;
            
            // Show Score Breakdown (NEW)
            const scoreText = `UTILITARIAN: ${scoreUtil} | DEONTOLOGY: ${scoreDeon}`;
            document.getElementById('score-breakdown').innerText = scoreText;

            // Animate Bar
            setTimeout(() => {
                document.getElementById('result-bar').style.width = utilPercent + "%";
            }, 500);

            // Determine Text
            let title = "";
            let text = "";

            if (scoreUtil >= 6) {
                title = "ARCHETYPE: RADICAL UTILITARIAN";
                text = "You are an agent of <strong>Efficiency</strong>. In almost every scenario, you chose to maximize the greater good, even when it required sacrificing individual rights or breaking moral rules.<br><br>Your logic aligns with <strong>Jeremy Bentham</strong>: 'The greatest happiness of the greatest number is the measure of right and wrong.' You view ethics as a calculation of consequences.";
            } else if (scoreDeon >= 6) {
                title = "ARCHETYPE: ABSOLUTE DEONTOLOGIST";
                text = "You are an agent of <strong>Principle</strong>. You consistently refused to treat people as means to an end. You upheld duties, rights, and honesty regardless of the disastrous consequences.<br><br>Your logic aligns with <strong>Immanuel Kant</strong>: 'Act only according to that maxim whereby you can, at the same time, will that it should become a universal law.'";
            } else {
                // NEUTRAL LOGIC UPDATED
                title = "ARCHETYPE: PRAGMATIC STRATEGIST";
                let leanText = "";
                
                if (scoreUtil > scoreDeon) {
                    leanText = "However, your record shows a <strong>slight leaning towards Utilitarianism</strong>. When pushed to the extreme, you tend to favor the outcome over the rule.";
                } else if (scoreDeon > scoreUtil) {
                    leanText = "However, your record shows a <strong>slight leaning towards Deontology</strong>. When pushed to the extreme, you tend to favor the principle over the result.";
                } else {
                    leanText = "Your record is <strong>perfectly balanced</strong>. You are a true wildcard, shifting your ethical framework based entirely on the specific context.";
                }

                text = `You are a <strong>Balancer</strong>. Your record shows a conflict between duty and utility. Sometimes you followed the rules; other times you broke them to save lives.<br><br>${leanText}<br><br>This demonstrates the complexity of real-world ethics. You are neither a cold calculator nor a rigid rule-follower. In your Game Log, explore <strong>why</strong> you switched systems when you did.`;
            }

            document.getElementById('result-title').innerHTML = title;
            document.getElementById('result-analysis').innerHTML = text;
        }

        // --- BACKGROUND PHYSICS (Matter.js) ---
        function initPhysics() {
            const Engine = Matter.Engine,
                  Render = Matter.Render,
                  Runner = Matter.Runner,
                  Bodies = Matter.Bodies,
                  Composite = Matter.Composite;

            const engine = Engine.create();
            const world = engine.world;
            
            const render = Render.create({
                element: document.getElementById('physics-canvas'),
                engine: engine,
                options: {
                    width: window.innerWidth,
                    height: window.innerHeight,
                    wireframes: false,
                    background: 'transparent'
                }
            });

            // Falling Data
            const debris = [];
            for (let i = 0; i < 50; i++) {
                const x = Math.random() * window.innerWidth;
                const y = Math.random() * -1000;
                const size = 10 + Math.random() * 30;
                const color = Math.random() > 0.5 ? '#003300' : '#001100';
                debris.push(Bodies.rectangle(x, y, size, size, {
                    render: { fillStyle: color },
                    restitution: 0.5
                }));
            }
            const ground = Bodies.rectangle(window.innerWidth/2, window.innerHeight+50, window.innerWidth, 100, { isStatic: true });
            
            Composite.add(world, [...debris, ground]);
            Render.run(render);
            const runner = Runner.create();
            Runner.run(runner, engine);
        }

    </script>
</body>
</html>
